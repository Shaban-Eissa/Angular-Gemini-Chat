<div class="h-full p-4 md:p-6 bg-gradient-to-b from-gray-50 to-white dark:from-gray-900 dark:to-gray-950">
  <div class="w-full h-full max-w-5xl mx-auto">
    <div
      class="mb-5 rounded-2xl bg-white dark:bg-gray-800 shadow border border-gray-200 dark:border-gray-700 p-4 md:p-5 flex items-center justify-between">
      <div class="flex items-start gap-3 md:gap-4">
        <div
          class="h-10 w-10 md:h-12 md:w-12 rounded-full bg-blue-600 text-white grid place-items-center font-semibold shadow-sm">
          AI
        </div>
        <div>
          <div class="text-lg md:text-xl font-semibold text-gray-900 dark:text-gray-100 leading-tight">Angular Code Chat
          </div>
          <div class="text-xs md:text-sm text-gray-600 dark:text-gray-400">Ask questions about your Angular codebase
            with RAG context from your files.</div>
          <div class="mt-2 flex flex-wrap items-center gap-1.5 md:gap-2 text-[11px] md:text-xs">
            <span
              class="inline-flex items-center gap-1.5 rounded-full border border-blue-200 dark:border-blue-800 bg-blue-50 dark:bg-blue-900/30 px-2.5 py-0.5 text-blue-700 dark:text-blue-300 whitespace-nowrap">Model:
              {{ modelName }}</span>
            <span
              class="inline-flex items-center gap-1.5 rounded-full border border-emerald-200 dark:border-emerald-800 bg-emerald-50 dark:bg-emerald-900/30 px-2.5 py-0.5 text-emerald-700 dark:text-emerald-300 whitespace-nowrap">Embeddings:
              {{ embeddingModel }}</span>
            <span
              class="inline-flex items-center gap-1.5 rounded-full border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 px-2.5 py-0.5 text-gray-700 dark:text-gray-300 whitespace-nowrap">TopK:
              {{ topK }}</span>
            <span
              class="inline-flex items-center gap-1.5 rounded-full border border-purple-200 dark:border-purple-800 bg-purple-50 dark:bg-purple-900/30 px-2.5 py-0.5 text-purple-700 dark:text-purple-300 truncate max-w-[220px] md:max-w-none">API:
              {{ backendUrl }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="flex flex-col h-[calc(100vh-220px)]">
      <div
        class="flex-1 overflow-y-auto scroll-smooth rounded-2xl border border-gray-200 dark:border-gray-700 p-4 md:p-5 space-y-4 md:space-y-5 bg-white dark:bg-gray-900"
        #scrollContainer>
        @for (m of messages(); track $index) {
        <div class="w-full">
          <div class="flex items-start gap-3 md:gap-4" [ngClass]="{ 'flex-row-reverse': m.role === 'user' }">
            <div
              class="h-8 w-8 md:h-9 md:w-9 rounded-full grid place-items-center text-[10px] md:text-xs font-semibold shadow-sm"
              [ngClass]="{
                'bg-blue-600 text-white': m.role === 'user',
                'bg-gray-700 text-white dark:bg-gray-600': m.role === 'assistant'
              }">
              {{ m.role === 'user' ? 'U' : 'AI' }}
            </div>
            <div
              class="relative max-w-[90%] md:max-w-[75%] px-3.5 md:px-4 py-2.5 md:py-3 rounded-2xl border text-[0.95rem] md:text-base leading-6 md:leading-7 message-content"
              [ngClass]="{
                'ml-auto bg-blue-50 text-blue-900 border-blue-200': m.role === 'user',
                'mr-auto bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-gray-200 dark:border-gray-700': m.role === 'assistant'
              }">
              <div [innerHTML]="renderedContent(m)"></div>
            </div>
          </div>
        </div>
        }
        @if (isSending()) {
        <div class="w-full">
          <div class="flex items-start gap-3 md:gap-4">
            <div
              class="h-8 w-8 md:h-9 md:w-9 rounded-full grid place-items-center text-[10px] md:text-xs font-semibold bg-gray-700 text-white">
              AI
            </div>
            <div
              class="mr-auto max-w-[90%] md:max-w-[75%] px-3.5 md:px-4 py-2.5 md:py-3 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl text-gray-900 dark:text-gray-200">
              <span class="inline-flex gap-1">
                <span class="animate-bounce">•</span>
                <span class="animate-bounce [animation-delay:150ms]">•</span>
                <span class="animate-bounce [animation-delay:300ms]">•</span>
              </span>
            </div>
          </div>
        </div>
        }
      </div>

      <div class="mt-4 sticky bottom-0 bg-gradient-to-t from-white dark:from-gray-900 pt-4">
        <div class="relative">
          <input type="text"
            class="w-full h-14 md:h-16 pr-14 md:pr-16 border border-gray-300 dark:border-gray-700 rounded-2xl px-4 focus:outline-none focus:ring-2 focus:ring-blue-300 dark:bg-gray-800 dark:text-gray-100 placeholder:text-gray-400 dark:placeholder:text-gray-500 text-[0.95rem] md:text-base"
            placeholder="Ask anything about your Angular code…" [ngModel]="input()" (ngModelChange)="input.set($event)"
            (keydown.enter)="onTextareaEnter($event)" />
          <button
            class="absolute bottom-2 right-2 inline-grid place-items-center h-10 w-10 md:h-12 md:w-12 rounded-full bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white shadow disabled:opacity-50 disabled:cursor-not-allowed"
            [disabled]="!canSend()" (click)="send()" aria-label="Send message">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 md:h-6 md:w-6" viewBox="0 0 24 24"
              fill="currentColor">
              <path d="M2.01 21 23 12 2.01 3 2 10l15 2-15 2z" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
